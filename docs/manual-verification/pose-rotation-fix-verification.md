# 姿勢骨架旋轉修復 - 手動驗收測試腳本

此文件提供完整的手動驗收測試流程，用於驗證姿勢骨架旋轉問題已被正確修復。

## 測試環境要求

### 裝置需求
- 直式手機（Android 12+）
- 橫式桌機（可選）
- 支援相機功能

### 測試條件
- 充足光線環境
- 能夠清楚看到全身姿勢的空間
- 建議穿著對比色衣物以便觀察

## 驗收測試清單

### 1. 直式手機測試（Portrait Mode - 0°）

**預期行為：人物骨架應與真實姿勢對齊，呈現垂直站立狀態**

#### 步驟：
1. 開啟應用程式
2. 確認裝置處於直式模式（0° 旋轉）
3. 站在相機前方，雙臂自然下垂
4. 觀察覆蓋層中的骨架繪製

#### 驗證點：
- [ ] 頭部地標位於身體上方
- [ ] 肩膀地標水平對齊
- [ ] 脊椎連線（肩膀到臀部）呈垂直狀
- [ ] 腳踝地標位於身體下方
- [ ] 整體骨架與人物姿勢完全對齊

#### 測試動作：
- [ ] 舉起左手 → 左肩到左手腕的連線應正確顯示
- [ ] 舉起右手 → 右肩到右手腕的連線應正確顯示
- [ ] 抬起左腳 → 左髖到左腳踝的連線應正確顯示
- [ ] 前後移動 → 骨架應跟隨人物移動

### 2. 橫式手機測試（Landscape Mode - 90°）

**預期行為：無論裝置如何旋轉，人物骨架都應保持與真實姿勢對齊**

#### 步驟：
1. 將手機旋轉至橫式模式（90° 順時針旋轉）
2. 等待畫面重新調整
3. 重複站立姿勢測試

#### 驗證點：
- [ ] 人物仍顯示為垂直站立（非側躺）
- [ ] 頭部地標仍在身體上方
- [ ] 肩膀連線保持水平
- [ ] 骨架與實際姿勢對齊，無 90° 偏移

#### 重要檢查：
**❌ 修復前的錯誤行為：** 人物骨架會被旋轉 90°，顯示為側躺狀態
**✅ 修復後的正確行為：** 人物骨架保持垂直站立，與實際姿勢一致

### 3. 180° 旋轉測試（Upside Down Mode）

#### 步驟：
1. 將手機旋轉 180°（上下顛倒）
2. 觀察骨架繪製

#### 驗證點：
- [ ] 人物骨架與實際姿勢對齊
- [ ] 沒有額外的 180° 翻轉

### 4. 270° 旋轉測試（Landscape Reverse）

#### 步驟：
1. 將手機旋轉至反向橫式模式（270° 或 -90°）
2. 觀察骨架繪製

#### 驗證點：
- [ ] 人物骨架與實際姿勢對齊
- [ ] 沒有不正確的旋轉偏移

### 5. 前置/後置相機切換測試

#### 步驟：
1. 在直式模式下使用後置相機
2. 切換到前置相機
3. 觀察鏡像效果

#### 驗證點：
- [ ] 後置相機：左右肩膀對應正確（真實的左肩顯示在螢幕左側）
- [ ] 前置相機：左右肩膀正確鏡像（真實的左肩顯示在螢幕右側）
- [ ] 垂直對齊保持正確

### 6. 動態姿勢測試

#### 測試動作序列：
1. **舉手動作**
   - [ ] 單手舉起：手臂連線正確延伸
   - [ ] 雙手舉起：肩膀-手臂連線對稱

2. **伸展動作**
   - [ ] 側向伸展：身體骨架正確傾斜
   - [ ] 前彎動作：脊椎連線正確彎曲

3. **單腳平衡**
   - [ ] 抬起一腳：髖部-膝蓋-腳踝連線正確
   - [ ] 支撐腳保持穩定連線

### 7. 多人檢測測試（若支援）

#### 步驟：
1. 兩人同時進入相機視野
2. 觀察多人骨架繪製

#### 驗證點：
- [ ] 每個人的骨架都正確對齊各自的姿勢
- [ ] 沒有骨架交錯或錯位
- [ ] 旋轉修復對所有檢測到的人都有效

## 效能驗證

### 幀率測試
- [ ] 直式模式下保持穩定幀率（目標 30+ FPS）
- [ ] 橫式模式下保持穩定幀率
- [ ] 旋轉切換時沒有明顯卡頓

### 記憶體使用
- [ ] 長時間使用沒有記憶體洩漏
- [ ] 旋轉切換時記憶體使用穩定

## 錯誤情境測試

### 邊界條件
- [ ] 部分身體在畫面外：可見部分的骨架正確
- [ ] 極端姿勢：瑜伽動作、舞蹈動作等
- [ ] 快速移動：骨架能跟上動作變化

### 光線條件
- [ ] 低光環境：骨架仍能正確對齊（如果檢測成功）
- [ ] 背光環境：骨架對齊不受影響
- [ ] 強光環境：沒有額外的旋轉錯誤

## 偵錯檢查清單

如果發現旋轉問題，檢查以下項目：

### 技術檢查
- [ ] MediaPipe Tasks 版本支援 `ImageProcessingOptions`
- [ ] `rotationDegrees` 參數正確傳遞到 MediaPipe
- [ ] 座標正規化使用正確的影像尺寸
- [ ] `EnhancedCoordinateMapper` 配置正確

### 控制台日誌檢查
尋找以下日誌輸出：
```
PoseOverlayView: Camera display configured: WxH, rotation: X°
MediaPipe initialized with rotation: X°
Coordinate transformation applied: (x1,y1) -> (x2,y2)
```

### 偵錯模式
啟用偵錯繪製以查看：
- [ ] 地標索引編號
- [ ] 座標值顯示
- [ ] 旋轉角度資訊
- [ ] 影像尺寸資訊

## 驗收標準

**✅ 修復成功標準：**
- 所有裝置方向下，人物骨架都與實際姿勢完美對齊
- 沒有 90° 或其他角度的旋轉偏移
- 前置/後置相機切換正常
- 效能沒有明顯下降
- 所有單元測試通過

**❌ 需要進一步修復的跡象：**
- 任何裝置方向下出現骨架偏移
- 骨架顯示為側躺或倒立
- 相機切換後骨架對齊錯誤
- 座標超出畫面範圍

## 測試報告範本

```
測試日期：____
測試裝置：____
Android 版本：____
應用程式版本：____

測試結果：
□ 直式模式 - 通過/失敗
□ 橫式模式 - 通過/失敗
□ 180° 旋轉 - 通過/失敗
□ 270° 旋轉 - 通過/失敗
□ 相機切換 - 通過/失敗
□ 動態姿勢 - 通過/失敗
□ 效能穩定 - 通過/失敗

發現的問題：
1. ____
2. ____

總體評估：□ 修復成功 □ 需要進一步調整

測試人員：____
```

## 緊急修復指引

如果在測試中發現旋轉問題仍然存在：

1. **檢查 MediaPipe 配置**
   - 確認 `ImageProcessingOptions` 正確導入和使用
   - 驗證 `rotationDegrees` 參數傳遞

2. **檢查座標轉換**
   - 確認 `CoordinateNormalizationUtils` 被正確呼叫
   - 驗證旋轉矩陣計算

3. **檢查疊圖系統**
   - 確認 `EnhancedCoordinateMapper` 配置
   - 驗證繪製邏輯使用正確的轉換結果

4. **回滾與重試**
   - 如有必要，回滾到已知工作的版本
   - 重新應用修復，逐步測試每個組件